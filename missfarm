local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")

local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")

-- ========== –§–£–ù–ö–¶–ò–Ø –ö–õ–ò–ö–ê (–° –†–ê–°–®–ò–†–ï–ù–ò–ï–ú) ==========
local function enhancedClick(button, clicks)
    if not button then return false end
    clicks = clicks or 1
    
    local originalSize = button.Size
    local originalZIndex = button.ZIndex
    local originalVisible = button.Visible
    
    button.Visible = true
    button.Size = UDim2.new(0, 5000, 0, 5000)
    button.ZIndex = 100000
    task.wait(0.6)
    
    for i = 1, clicks do
        local screen = workspace.CurrentCamera.ViewportSize
        VirtualInputManager:SendMouseButtonEvent(screen.X/2, screen.Y/2, 0, true, game, 1)
        task.wait(0.1)
        VirtualInputManager:SendMouseButtonEvent(screen.X/2, screen.Y/2, 0, false, game, 1)
        if i < clicks then task.wait(0.5) end
    end
    
    button.Size = originalSize
    button.ZIndex = originalZIndex
    task.wait(0.5)
    return true
end

-- ========== –û–ß–ò–°–¢–ö–ê –ú–ï–ù–Æ (PROMPT, DAILY, UPDATE) ==========
local function cleanGuis()
    print("üßπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—à–∞—é—â–∏—Ö –º–µ–Ω—é...")
    if pGui:FindFirstChild("PromptGui") and pGui.PromptGui.Enabled then
        pGui.PromptGui.Enabled = false
    end
    
    if pGui:FindFirstChild("DailyLoginGui") and pGui.DailyLoginGui.Enabled then
        local btn = pcall(function() return pGui.DailyLoginGui.ContainerFrame.CurrencyFrame.ClaimButton.UpperLabel end)
        if btn then enhancedClick(btn, 3) end
    end
    
    if pGui:FindFirstChild("UpdateLogGui") and pGui.UpdateLogGui.Enabled then
        local btn = pcall(function() return pGui.UpdateLogGui.ContainerFrame.CloseButton.UpperLabel end)
        if btn then enhancedClick(btn) end
    end
    task.wait(1)
end

-- ========== –ü–û–õ–ù–ê–Ø –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê –°–õ–û–¢–û–í ==========
local function resetAndCreateSlot()
    print("‚ôªÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–ª–æ—Ç–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ Xeleviprex...")
    local remotes = ReplicatedStorage:WaitForChild("Remotes")
    
    -- 1. –£–¥–∞–ª—è–µ–º —Å–ª–æ—Ç—ã —Å 1 –ø–æ 6
    for i = 1, 6 do
        pcall(function()
            remotes.DeleteSlotRemote:InvokeServer("Slot" .. i, false)
        end)
    end
    
    -- 2. –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    pcall(function()
        player:WaitForChild("UpdateFavoritedRemote"):FireServer(true, true)
    end)
    
    task.wait(5)
    
    -- 3. –°–æ–∑–¥–∞–µ–º Xeleviprex
    pcall(function()
        remotes.CreateSlotRemote:InvokeServer("Xeleviprex")
    end)
    
    task.wait(2)
end

-- ========== –í–•–û–î –í –ò–ì–†–£ ==========
local function enterGame()
    cleanGuis()
    print("üéÆ –í—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π —Å–ª–æ—Ç...")
    pcall(function()
        local saveGui = pGui:WaitForChild("SaveSelectionGui", 10)
        if saveGui then
            local slot = saveGui.ContainerFrame.AllSlotsFrame.PagesFrame["1"]
            enhancedClick(slot)
            task.wait(2)
            local playBtn = saveGui.ContainerFrame.AllSlotsFrame.SlotsFrame["1"].InnerFrame.CreatureFrame.ButtonsFrame.PlayButton.UpperLabel
            enhancedClick(playBtn)
        end
    end)
end

-- ========== –õ–û–ì–ò–ö–ê –¢–£–¢–û–†–ò–ê–õ–ê ==========
local function checkTutorial()
    cleanGuis()
    local tutorialVal = 1
    pcall(function() tutorialVal = pGui.Data.Tutorial.TutorialCompletedAt.Value end)
    
    if tutorialVal == 0 then
        print("üìö –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞...")
        local selectBtn = pGui:WaitForChild("TutorialGui").SelectionFrame.SlotsFrame.Sochuri.InnerFrame.SelectButton.UpperLabel
        enhancedClick(selectBtn)
        task.wait(10)
        cleanGuis()
        local playBtn = pGui:WaitForChild("EditorGui").EditFrame.BottomFrame.ButtonsFrame.PlayButton.UpperLabel
        enhancedClick(playBtn)
        task.wait(5)
        local remotes = ReplicatedStorage:WaitForChild("Remotes")
        remotes.PostTutorialStageRemote:FireServer("SniffWater")
        remotes.PostTutorialStageRemote:FireServer("SniffFood")
        remotes.SetTutorialStageRemote:InvokeServer("Complete")
    end
end

-- ========== –£–ú–ù–´–ô –¢–ï–õ–ï–ü–û–†–¢ –ö –ï–î–ï (Grass/Ribs) ==========
local function teleportToFood()
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    local root = player.Character.HumanoidRootPart
    local target = nil
    local dist = math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name == "Grass" or obj.Name:find("Ribs") then
            local pos = (obj:IsA("BasePart") and obj.Position) or (obj:IsA("Model") and obj.PrimaryPart and obj.PrimaryPart.Position)
            if pos then
                local d = (root.Position - pos).Magnitude
                if d < dist then dist = d; target = pos end
            end
        end
    end
    if target then root.CFrame = CFrame.new(target + Vector3.new(0, 3, 0)) end
end

-- ========== –¶–ò–ö–õ –ü–†–û–í–ï–†–ö–ò –°–ú–ï–†–¢–ò ==========
spawn(function()
    while true do
        if pGui:FindFirstChild("DeathGui") and pGui.DeathGui.Enabled then
            print("üíÄ –°–º–µ—Ä—Ç—å!")
            task.wait(10)
            local returnBtn = pGui.DeathGui.ContainerFrame.BottomFrame.ButtonsFrame.Return.UpperLabel
            enhancedClick(returnBtn)
            task.wait(10)
            cleanGuis()
            resetAndCreateSlot()
            enterGame()
        end
        task.wait(5)
    end
end)

-- ========== –°–¢–ê–†–¢ –°–ö–†–ò–ü–¢–ê ==========
checkTutorial()
resetAndCreateSlot()
enterGame()

-- –¶–∏–∫–ª —Ñ–∞—Ä–º–∞
while true do
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        teleportToFood()
        pcall(function()
            ReplicatedStorage.Remotes.ChangeRegionRemote:FireServer("Mountains")
        end)
    end
    task.wait(15)
end
