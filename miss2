-- –°–ö–†–ò–ü–¢ ‚Ññ1: –í–•–û–î, –¢–£–¢–û–†–ò–ê–õ, –ß–ò–°–¢–ö–ê UpdateLogGui –ò –õ–ò–ú–ò–¢ 300
local VirtualInputManager = game:GetService("VirtualInputManager")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local pGui = player:WaitForChild("PlayerGui")
local remotes = ReplicatedStorage:WaitForChild("Remotes")

local CREATURE_NAME = "Xeleviprex"

-- ========== –°–ò–°–¢–ï–ú–ê –ö–õ–ò–ö–û–í (–†–ê–ó–î–£–í–ê–ù–ò–ï) ==========
local function clickAtPosition(posX, posY)
    VirtualInputManager:SendMouseButtonEvent(posX, posY, 0, true, game, 1)
    wait(0.1)
    VirtualInputManager:SendMouseButtonEvent(posX, posY, 0, false, game, 1)
end

local function click()
    local screen = workspace.CurrentCamera.ViewportSize
    clickAtPosition(screen.X/2, screen.Y/2)
end

local function clickButtonEnhanced(button, buttonName)
    if button then
        print("‚úÖ –†–∞–∑–¥—É–≤–∞—é –∫–Ω–æ–ø–∫—É –¥–ª—è –∫–ª–∏–∫–∞: " .. buttonName)
        local originalSize = button.Size
        local originalPosition = button.Position
        local originalAnchorPoint = button.AnchorPoint
        local originalZIndex = button.ZIndex
        
        button.Size = UDim2.new(100, 0, 100, 0)
        button.Position = UDim2.new(0.5, 0, 0.5, 0)
        button.AnchorPoint = Vector2.new(0.5, 0.5)
        button.ZIndex = 99999
        
        wait(1.5) 
        local screen = workspace.CurrentCamera.ViewportSize
        clickAtPosition(screen.X / 2, screen.Y / 2)
        
        wait(0.5)
        button.Size = originalSize
        button.Position = originalPosition
        button.AnchorPoint = originalAnchorPoint
        button.ZIndex = originalZIndex
        return true
    end
    return false
end

-- ========== –°–ö–†–´–¢–ò–ï –ú–ï–ù–Æ –ò –§–ò–ö–° UpdateLogGui ==========
local function cleanAllMenus()
    print("üßπ –ì–ª—É–±–æ–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ GUI...")
    
    -- –ü—Ä—è–º–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ UpdateLogGui —á–µ—Ä–µ–∑ —Ä–∞–∑–¥—É–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    local updateLog = pGui:FindFirstChild("UpdateLogGui")
    if updateLog and updateLog.Enabled then
        local closeBtn = updateLog:FindFirstChild("ContainerFrame")
        if closeBtn then closeBtn = closeBtn:FindFirstChild("CloseButton") end
        if closeBtn then closeBtn = closeBtn:FindFirstChild("UpperLabel") end
        
        if closeBtn then
            clickButtonEnhanced(closeBtn, "UpdateLogGui.CloseButton")
        else
            updateLog.Enabled = false -- –ï—Å–ª–∏ –∫–Ω–æ–ø–∫—É –Ω–µ –Ω–∞—à–ª–∏, –ø—Ä–æ—Å—Ç–æ –≤—ã–∫–ª—é—á–∞–µ–º
        end
    end

    -- –°–∫—Ä—ã—Ç–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –º–µ—à–∞—é—â–∏—Ö –æ–∫–æ–Ω
    local guisToHide = {"PromptGui", "DialogGui", "DialogMenu", "SkipGui"}
    for _, name in ipairs(guisToHide) do
        local g = pGui:FindFirstChild(name)
        if g then g.Enabled = false end
    end
end

-- ========== –õ–û–ì–ò–ö–ê –¢–£–¢–û–†–ò–ê–õ–ê (GUI + REQUES–¢S) ==========
local function handleTutorial()
    local data = pGui:FindFirstChild("Data")
    local tutorialVal = data and data:FindFirstChild("Tutorial") and data.Tutorial:FindFirstChild("TutorialCompletedAt")
    
    if tutorialVal and tutorialVal.Value == 0 then
        print("üìö –¢—É—Ç–æ—Ä–∏–∞–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω. –ü—Ä–æ—Ö–æ–∂—É...")
        local tutorialGui = pGui:WaitForChild("TutorialGui")
        if tutorialGui.Enabled then
            local selectBtn = tutorialGui.SelectionFrame.SlotsFrame.Sochuri.InnerFrame.SelectButton.UpperLabel
            clickButtonEnhanced(selectBtn, "TutorialSelect")
            wait(15)
            
            local editorGui = pGui:WaitForChild("EditorGui")
            local playBtn = editorGui.EditFrame.BottomFrame.ButtonsFrame.PlayButton.UpperLabel
            clickButtonEnhanced(playBtn, "TutorialPlay")
            
            wait(2)
            -- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Ç—É—Ç–æ—Ä–∏–∞–ª–∞
            pcall(function() remotes.PostTutorialStageRemote:FireServer("SniffWater") end)
            wait(0.5)
            pcall(function() remotes.PostTutorialStageRemote:FireServer("SniffFood") end)
            wait(0.5)
            pcall(function() remotes.SetTutorialStageRemote:InvokeServer("SurvivalBasics") end)
            wait(0.1)
            pcall(function() remotes.SetTutorialStageRemote:InvokeServer("Complete") end)
            print("üéâ –¢—É—Ç–æ—Ä–∏–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω.")
        end
    end
end

-- ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–õ–û–¢–ê–ú–ò ==========
local function prepareSlots()
    print("üóëÔ∏è –°–±—Ä–æ—Å —Å–ª–æ—Ç–æ–≤...")
    for i = 1, 6 do pcall(function() remotes.DeleteSlotRemote:InvokeServer("Slot" .. i, false) end) end
    wait(2)
    pcall(function() player:WaitForChild("UpdateFavoritedRemote"):FireServer(true, true) end)
    wait(1)
    pcall(function() remotes.CreateSlotRemote:InvokeServer(CREATURE_NAME) end)
    wait(15)
end

-- ========== –í–•–û–î –ò –¶–ò–ö–õ –ü–†–û–í–ï–†–ö–ò (300 –ú–ò–°–°–ò–ô + –°–ú–ï–†–¢–¨) ==========
local function enterGame()
    cleanAllMenus()
    local saveGui = pGui:WaitForChild("SaveSelectionGui")
    if saveGui.Enabled then
        clickButtonEnhanced(saveGui.ContainerFrame.AllSlotsFrame.PagesFrame["1"], "Page1")
        wait(2)
        clickButtonEnhanced(saveGui.ContainerFrame.AllSlotsFrame.SlotsFrame["1"].InnerFrame.CreatureFrame.ButtonsFrame.PlayButton.UpperLabel, "PlayButton")
        wait(0.5) click()
    end
end

-- –°–ª–µ–∂–∫–∞ –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–≥—Ä–æ–∫–∞
spawn(function()
    while true do
        -- 1. –§–∏–∫—Å 300 –º–∏—Å—Å–∏–π
        pcall(function()
            local missions = pGui.Data.Slot1.DeathStats.MissionsCompleted.Value
            if missions >= 300 then
                print("üèÜ 300 –º–∏—Å—Å–∏–π! –†–µ—Å–µ—Ç —á–µ—Ä–µ–∑ OutOfBounds...")
                remotes.OutOfBoundsSelfDamage:FireServer(25000)
            end
        end)

        -- 2. –§–∏–∫—Å DeathGui
        local deathGui = pGui:FindFirstChild("DeathGui")
        if deathGui and deathGui.Enabled then
            print("üíÄ –°–º–µ—Ä—Ç—å. –û–∂–∏–¥–∞–Ω–∏–µ 12 —Å–µ–∫...")
            wait(12)
            clickButtonEnhanced(deathGui.ContainerFrame.BottomFrame.ButtonsFrame.Return.UpperLabel, "DeathReturn")
            wait(10)
            prepareSlots()
            enterGame()
        end
        wait(5)
    end
end)

-- –°–¢–ê–†–¢
prepareSlots()
handleTutorial()
enterGame()
