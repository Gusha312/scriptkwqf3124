local TargetName = "anqyura" -- Ник для ударов

-- [[ СЕРВИСЫ ]]
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer

-- [[ ФУНКЦИИ ПОМОЩНИКИ ]]
local function forceExpandAndClick(button)
    if not button then return end
    
    local oldSize = button.Size
    local oldPos = button.Position
    local oldZ = button.ZIndex
    local oldAnchor = button.AnchorPoint

    -- Функция применения размера
    local function applyMassive()
        button.AnchorPoint = Vector2.new(0.5, 0.5)
        button.Size = UDim2.new(0, 9999999, 0, 9999999)
        button.Position = UDim2.new(0.5, 0, 0.5, 0)
        button.ZIndex = 9999999
        -- Отключаем ограничения пропорций, чтобы кнопка реально стала на весь экран
        for _, child in pairs(button:GetChildren()) do
            if child:IsA("UIAspectRatioConstraint") then child.Enabled = false end
        end
    end

    -- Первый клик
    local t1 = tick()
    while tick() - t1 < 0.6 do
        applyMassive()
        task.wait()
    end
    VirtualInputManager:SendMouseButtonEvent(500, 500, 0, true, game, 0)
    task.wait(0.1)
    VirtualInputManager:SendMouseButtonEvent(500, 500, 0, false, game, 0)
    
    task.wait(0.7)

    -- Второй клик
    local t2 = tick()
    while tick() - t2 < 0.6 do
        applyMassive()
        task.wait()
    end
    VirtualInputManager:SendMouseButtonEvent(500, 500, 0, true, game, 0)
    task.wait(0.1)
    VirtualInputManager:SendMouseButtonEvent(500, 500, 0, false, game, 0)

    task.wait(0.5)
    
    -- Возврат исходных данных
    button.AnchorPoint = oldAnchor
    button.Size = oldSize
    button.Position = oldPos
    button.ZIndex = oldZ
end

local function applyDamage(targetName)
    local victim = Players:FindFirstChild(targetName)
    if victim and victim.Character then
        local args = {{victim.Character}}
        ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CharactersDamageRemoteBreath"):FireServer(unpack(args))
    end
end

local function teleportTo(cframe)
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart", 5)
    if hrp then
        hrp.AssemblyLinearVelocity = Vector3.new(0,0,0)
        char:PivotTo(cframe)
        task.wait(0.1)
        char:PivotTo(cframe)
    end
end

-- [[ ИНИЦИАЛИЗАЦИЯ ]]
print("Ожидание 9 секунд...")
task.wait(9)

-- Базовые действия
pcall(function()
    ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("ClaimDailyLoginRemote"):FireServer()
    LocalPlayer:WaitForChild('UpdateFavoritedRemote'):FireServer(true, true)
    
    local remotes = ReplicatedStorage:WaitForChild("Remotes")
    for i = 1, 5 do
        remotes:WaitForChild("DeleteSlotRemote"):InvokeServer("Slot" .. i, false)
    end
end)

task.wait(5)
pcall(function()
    ReplicatedStorage.Remotes.CreateSlotRemote:InvokeServer("Xeleviprex")
end)
task.wait(2)

if LocalPlayer.PlayerGui:FindFirstChild("PromptGui") then
    LocalPlayer.PlayerGui.PromptGui.Enabled = false
end

-- Фоновый дамаг
task.spawn(function()
    while true do
        task.wait(0.1)
        applyDamage(TargetName)
    end
end)

-- [[ ЦИКЛ ФАРМА ]]
task.spawn(function()
    local remotes = ReplicatedStorage:WaitForChild("Remotes")
    while true do
        -- НОВОЕ: Проверка UpdateLogGui
        pcall(function()
            local logGui = LocalPlayer.PlayerGui:FindFirstChild("UpdateLogGui")
            if logGui and logGui.Enabled then
                local closeBtn = logGui.ContainerFrame.CloseButton.UpperLabel
                print("UpdateLog обнаружен. Закрываю...")
                forceExpandAndClick(closeBtn)
                task.wait(1)
            end
        end)

        -- 1. Подготовка слота
        pcall(function() remotes.RestartSlotRemote:InvokeServer("Slot1", false) end)
        task.wait(1)
        pcall(function() remotes.UseTokenRemote:InvokeServer("FullGrowToken", "Slot1") end)
        task.wait(1)
        
        -- 2. РАСШИРЕНИЕ И КЛИК НА СЛОТ
        pcall(function()
            local slotBtn = LocalPlayer.PlayerGui.SaveSelectionGui.ContainerFrame.AllSlotsFrame.PagesFrame["1"]
            forceExpandAndClick(slotBtn)
        end)
        
        task.wait(1.5)
        
        -- 3. РАСШИРЕНИЕ И КЛИК НА КНОПКУ PLAY
        pcall(function()
            local playBtn = LocalPlayer.PlayerGui.SaveSelectionGui.ContainerFrame.AllSlotsFrame.SlotsFrame["1"].InnerFrame.CreatureFrame.ButtonsFrame.PlayButton.UpperLabel
            forceExpandAndClick(playBtn)
        end)
        
        task.wait(3)
        
        -- 4. ГЕЙМПЛЕЙ (ТП, Способность, Смерть)
        teleportTo(CFrame.new(-1722.5238, 405.246979, -1250.83057, -0.115354449, -0.73168236, 0.671814144, -0.781221807, 0.484544933, 0.39358446, -0.613502979, -0.479434073, -0.627500594))
        task.wait(3)
        pcall(function() remotes.ActivateAbility:FireServer("Spite") end)
        task.wait(2)
        remotes.OutOfBoundsSelfDamage:FireServer(25000)
        remotes.OutOfBoundsSelfDamage:FireServer(25000)
        remotes.OutOfBoundsSelfDamage:FireServer(25000)
        
        -- 5. ВОЗВРАТ ПОСЛЕ СМЕРТИ
        local deathGui = LocalPlayer.PlayerGui:WaitForChild("DeathGui")
        while not deathGui.Enabled do task.wait(0.5) end
        task.wait(8)
        
        pcall(function()
            local returnBtn = deathGui.ContainerFrame.BottomFrame.ButtonsFrame.Return.UpperLabel
            forceExpandAndClick(returnBtn)
        end)
        
        task.wait(3)
    end
end)
