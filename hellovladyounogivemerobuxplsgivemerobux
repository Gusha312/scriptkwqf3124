-- –ü–æ–ª—É—á–∞–µ–º –≤–µ–±—Ö—É–∫ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
local DISCORD_WEBHOOK = _G.Discord or "https://discord.com/api/webhooks/1412481203260489830/wq6fMRWEnGhEDhruEv7jG4ge23LT6rp1KPNqofXSLo5SHz8hr188AblViZLHbvjoIo"

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

print("ü§ñ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω! –í–µ–±—Ö—É–∫: " .. DISCORD_WEBHOOK)

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ FPS –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
local MAX_FPS = 360
local MIN_FPS = 5
local RENDER = true

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ FPS –ª–∏–º–∏—Ç–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
local function setFpsCap(fps)
    if type(setfpscap) == "function" then
        setfpscap(fps)
        print("üéØ FPS –ª–∏–º–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: " .. fps)
    else
        print("‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è setfpscap –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞")
    end
end

-- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è FPS –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ/–ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞
UserInputService.WindowFocused:Connect(function()
    if RENDER then
        RunService:Set3dRenderingEnabled(true)
        print("üñ•Ô∏è –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–∫–ª—é—á–µ–Ω")
    end
    setFpsCap(MAX_FPS)
end)

UserInputService.WindowFocusReleased:Connect(function()
    if RENDER then
        RunService:Set3dRenderingEnabled(false)
        print("üîá –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –æ—Ç–∫–ª—é—á–µ–Ω")
    end
    setFpsCap(MIN_FPS)
end)

-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
if RENDER then
    RunService:Set3dRenderingEnabled(true)
end
setFpsCap(MAX_FPS)

local MarketRemotes = ReplicatedStorage:WaitForChild("Remotes")
local ClaimStall = MarketRemotes:WaitForChild("ClaimStall")

local stallCFrames = {
    CFrame.new(-115.76767, 31.4889774, -83.580658, -0.882971644, -0.469426453, -1.34855509e-05, 1.34855509e-05, -5.41210175e-05, 1, -0.469426453, 0.882971644, 5.40614128e-05),
    CFrame.new(-80.3615417, 31.4889774, -23.9790859, -0.0349992514, -0.999387324, 4.3451786e-05, -4.3451786e-05, 4.50015068e-05, 1, -0.999387324, 0.0349992514, -4.50611115e-05),
    CFrame.new(-85.1257629, 31.4889774, 0.639569223, 0.342006564, -0.939697623, -7.00354576e-06, -7.00354576e-06, -1.00135803e-05, 1, -0.939697623, -0.342006564, -1.00135803e-05),
    CFrame.new(-142.565216, 31.4889774, -92.6095505, -0.99452734, -0.104477406, 2.75298953e-06, -2.75298953e-06, 5.2511692e-05, 1, -0.104477406, 0.99452728, -5.25712967e-05),
    CFrame.new(-168.641525, 31.4889774, -90.8674011, -0.97028327, 0.241971374, -2.48849392e-06, 2.48849392e-06, 2.02655792e-05, 0.99999994, 0.241971374, 0.970283329, -2.02655792e-05),
    CFrame.new(-191.504898, 31.4889774, -81.1337967, -0.787993431, 0.615683556, 1.41859055e-05, -1.41859055e-05, -4.12464142e-05, 1, 0.615683556, 0.78799355, 4.12464142e-05),
    CFrame.new(-160.504944, 31.4889774, 46.381073, 0.99452728, 0.104477406, -2.75298953e-06, -2.75298953e-06, 5.2511692e-05, 1, 0.104477406, -0.99452728, 5.2511692e-05),
    CFrame.new(-134.42865, 31.4889774, 44.6389275, 0.970283389, -0.241971403, 2.48104334e-06, 2.48104334e-06, 2.01463699e-05, 1.00000012, -0.241971403, -0.970283508, 2.01463699e-05),
    CFrame.new(-187.302505, 31.4889774, 37.3521729, 0.882971585, 0.469426453, 1.34855509e-05, 1.34855509e-05, -5.41210175e-05, 1, 0.469426453, -0.882971644, -5.41210175e-05),
    CFrame.new(-111.565277, 31.4889774, 34.9053154, 0.78799355, -0.615683556, -1.41859055e-05, -1.41859055e-05, -4.12464142e-05, 1, -0.615683556, -0.78799355, -4.12464142e-05)
}

local marketStalls = workspace:WaitForChild("Interactable"):WaitForChild("MarketStalls")
local localPlayer = Players.LocalPlayer

-- –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞ –≤ Discord
local function sendDiscordWebhook()
    local success, coins = pcall(function()
        return localPlayer.Data.Coins.Value
    end)
    
    if not success then
        warn("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç")
        return false
    end
    
    local playerName = localPlayer.Name
    
    local embed = {
        {
            title = "üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê",
            color = 5814783,
            fields = {
                {
                    name = "üçÑ –ì—Ä–∏–±–æ–≤",
                    value = tostring(coins),
                    inline = true
                },
                {
                    name = "üë§ –ù–∏–∫ –≤ Roblox",
                    value = playerName,
                    inline = true
                }
            },
            footer = {
                text = "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
            },
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }
    }
    
    local message = {
        embeds = embed,
        username = "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞",
        avatar_url = "https://cdn.discordapp.com/emojis/1125274830327718010.webp?size=96&quality=lossless"
    }
    
    local success, response = pcall(function()
        local http = game:GetService("HttpService")
        local response = request({
            Url = DISCORD_WEBHOOK,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = http:JSONEncode(message)
        })
        return response
    end)
    
    if success then
        print("‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ Discord! –ì—Ä–∏–±–æ–≤: "..coins)
        return true
    else
        warn("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞")
        return false
    end
end

-- –¢–∞–π–º–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ–±—Ö—É–∫–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
local function startWebhookTimer()
    while true do
        wait(1800) -- 30 –º–∏–Ω—É—Ç
        sendDiscordWebhook()
    end
end

-- –ê–Ω—Ç–∏-AFK —Å–∏—Å—Ç–µ–º–∞
local function setupAntiAFK()
    local connection
    connection = game:GetService("RunService").Heartbeat:Connect(function()
        VirtualInputManager:SendMouseMoveEvent(10, 10, game:GetService("Workspace"))
        VirtualInputManager:SendMouseMoveEvent(20, 20, game:GetService("Workspace"))
        
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.W, false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.W, false, game)
        
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.A, false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.A, false, game)
    end)
    
    return connection
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏
local function checkTeleportConditions()
    local currentPlayers = #Players:GetPlayers()
    local currentPlaceId = game.PlaceId
    
    print("üìç –¢–µ–∫—É—â–∏–π –ø–ª–µ–π—Å ID:", currentPlaceId)
    print("üë• –ò–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:", currentPlayers)
    
    if currentPlaceId == 5233782396 then
        print("üöÄ –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –≤ 14119723130...")
        TeleportService:Teleport(14119723130, localPlayer)
        return true
    end
    
    if currentPlayers <= 20 then
        print("üîÅ –ú–∞–ª–æ –∏–≥—Ä–æ–∫–æ–≤ ("..currentPlayers.."), –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫...")
        TeleportService:Teleport(currentPlaceId, localPlayer)
        return true
    end
    
    return false
end

-- –ü–æ–∏—Å–∫ AnchorPart –ø–æ CFrame
local function findAnchorPartByCFrame(targetCFrame)
    for _, child in pairs(marketStalls:GetChildren()) do
        if child:IsA("BasePart") and child.Name == "AnchorPart" then
            local positionDiff = (child.CFrame.Position - targetCFrame.Position).Magnitude
            if positionDiff < 1 then
                return child
            end
        end
    end
    return nil
end

-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
local function main()
    print("üéØ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω!")
    print("‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è FPS –∞–∫—Ç–∏–≤–Ω–∞: "..MAX_FPS.." FPS (–≤ —Ñ–æ–∫—É—Å–µ), "..MIN_FPS.." FPS (–Ω–µ –≤ —Ñ–æ–∫—É—Å–µ)")
    print("üé® –†–µ–Ω–¥–µ—Ä–∏–Ω–≥: "..(RENDER and "–≤–∫–ª—é—á–µ–Ω" or "–≤—ã–∫–ª—é—á–µ–Ω"))
    
    local antiAFKConnection = setupAntiAFK()
    coroutine.wrap(startWebhookTimer)()
    sendDiscordWebhook()
    
    while true do
        if checkTeleportConditions() then
            wait(5)
            break
        end
        
        for i, stallCFrame in ipairs(stallCFrames) do
            local anchorPart = findAnchorPartByCFrame(stallCFrame)
            
            if anchorPart then
                local args = {anchorPart}
                ClaimStall:FireServer(unpack(args))
                print("üîÑ –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–Ω—è—Ç—å –ª–∞–≤–∫—É #"..i)
            else
                warn("‚ùå –õ–∞–≤–∫–∞ #"..i.." –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            end
            
            wait(0.3)
        end
        
        print("‚è≥ –¶–∏–∫–ª –∑–∞–≤–µ—Ä—à–µ–Ω. –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã...")
        wait(2)
    end
    
    if antiAFKConnection then
        antiAFKConnection:Disconnect()
    end
end

-- –ó–∞–ø—É—Å–∫
local success, errorMsg = pcall(main)
if not success then
    warn("üí• –û—à–∏–±–∫–∞: "..errorMsg)
    print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
    wait(10)
    main()
end
