local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
local CURRENT_PLACE_ID = game.PlaceId
local TARGET_PLACE_ID = 14119723130
local MAIN_PLACE_ID = 5233782396

local TARGET_POSITIONS = {
    Vector3.new(-115.76767, 31.4889774, -83.580658),
    Vector3.new(-80.3615417, 31.4889774, -23.9790859),
    Vector3.new(-85.1257629, 31.4889774, 0.639569223),
    Vector3.new(-142.565216, 31.4889774, -92.6095505),
    Vector3.new(-168.641525, 31.4889774, -90.8674011),
    Vector3.new(-191.504898, 31.4889774, -81.1337967),
    Vector3.new(-160.504944, 31.4889774, 46.381073),
    Vector3.new(-134.42865, 31.4889774, 44.6389275),
    Vector3.new(-187.302505, 31.4889774, 37.3521729),
    Vector3.new(-111.565277, 31.4889774, 34.9053154)
}

local MIN_PLAYERS = 20
local MAX_DISTANCE = 15 -- –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–∏—Å—Ç–∞–Ω—Ü–∏—é
local CHECK_INTERVAL = 30
local STALL_CHECK_INTERVAL = 2 -- –¢–û–ß–ù–û –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã

-- –ö—ç—à –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
local localPlayer = Players.LocalPlayer
local claimStallRemote = game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild("ClaimStall")

local lastMouseMove = os.time()
local lastStallCheck = 0

-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –ª–∞–≤–∫–∏
function buyStall(stall)
    if stall and stall:FindFirstChild("AnchorPart") then
        local args = {stall.AnchorPart}
        local success, result = pcall(function()
            claimStallRemote:FireServer(unpack(args))
            return true
        end)
        return success
    end
    return false
end

-- –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–∞–≤–æ–∫
function getAllStalls()
    local interactables = workspace:FindFirstChild("Interactable")
    if not interactables then return {} end
    
    local stalls = {}
    for _, stall in ipairs(interactables:GetChildren()) do
        if stall:FindFirstChild("AnchorPart") then
            table.insert(stalls, stall)
        end
    end
    return stalls
end

-- –ü—ã—Ç–∞–µ–º—Å—è –∫—É–ø–∏—Ç—å –í–°–ï –ª–∞–≤–∫–∏ —Ä—è–¥–æ–º —Å —Ü–µ–ª–µ–≤—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
function tryBuyAllStalls()
    local stalls = getAllStalls()
    if #stalls == 0 then
        print("–õ–∞–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
        return false
    end

    local boughtAny = false
    
    for _, targetPos in ipairs(TARGET_POSITIONS) do
        for _, stall in ipairs(stalls) do
            local anchor = stall.AnchorPart
            local distance = (anchor.Position - targetPos).Magnitude
            
            if distance <= MAX_DISTANCE then
                local success = buyStall(stall)
                if success then
                    print("‚úÖ –ö—É–ø–ª–µ–Ω–∞ –ª–∞–≤–∫–∞: " .. stall.Name .. " (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: " .. math.floor(distance) .. ")")
                    boughtAny = true
                    wait(0.1) -- –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–∫—É–ø–∫–∞–º–∏
                else
                    print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∫—É–ø–∏—Ç—å: " .. stall.Name)
                end
            end
        end
    end
    
    return boughtAny
end

-- –ü—ã—Ç–∞–µ–º—Å—è –∫—É–ø–∏—Ç—å –õ–Æ–ë–´–ï –ª–∞–≤–∫–∏ (–µ—Å–ª–∏ —Ü–µ–ª–µ–≤—ã–µ –Ω–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è)
function tryBuyAnyStall()
    local stalls = getAllStalls()
    if #stalls == 0 then return false end

    -- –ü—Ä–æ–±—É–µ–º –∫—É–ø–∏—Ç—å –ø–µ—Ä–≤—ã–µ 5 –ª–∞–≤–æ–∫
    for i = 1, math.min(5, #stalls) do
        local success = buyStall(stalls[i])
        if success then
            print("‚úÖ –ö—É–ø–ª–µ–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –ª–∞–≤–∫–∞: " .. stalls[i].Name)
            return true
        end
    end
    
    return false
end

-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏
function attemptStallPurchase()
    local currentTime = os.time()
    
    if currentTime - lastStallCheck >= STALL_CHECK_INTERVAL then
        print("\nüîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–∫—É–ø–∫–∏ –ª–∞–≤–æ–∫...")
        
        -- –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ–º—Å—è –∫—É–ø–∏—Ç—å —Ü–µ–ª–µ–≤—ã–µ –ª–∞–≤–∫–∏
        local bought = tryBuyAllStalls()
        
        -- –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ü–µ–ª–µ–≤—ã–µ, –ø—Ä–æ–±—É–µ–º –ª—é–±—ã–µ
        if not bought then
            print("–¶–µ–ª–µ–≤—ã–µ –ª–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã, –ø—Ä–æ–±—É–µ–º –ª—é–±—ã–µ...")
            tryBuyAnyStall()
        end
        
        lastStallCheck = currentTime
        return true
    end
    return false
end

-- –ê–Ω—Ç–∏-–ê–§–ö
function antiAFK()
    if os.time() - lastMouseMove >= 60 then
        VirtualInputManager:SendMouseMoveEvent(
            math.random(100, 500), 
            math.random(100, 500), 
            game
        )
        lastMouseMove = os.time()
    end
end

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
function checkPlayers()
    local playerCount = #Players:GetPlayers()
    print("üë• –ò–≥—Ä–æ–∫–æ–≤ –æ–Ω–ª–∞–π–Ω: " .. playerCount)
    
    if playerCount < MIN_PLAYERS then
        print("–°–ª–∏—à–∫–æ–º –º–∞–ª–æ –∏–≥—Ä–æ–∫–æ–≤, –∏—â—É –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä...")
        return false
    end
    return true
end

-- –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è –º–µ–∂–¥—É –ø–ª–µ–π—Å–∞–º–∏
function handlePlaceTeleportation()
    if CURRENT_PLACE_ID == MAIN_PLACE_ID then
        print("üöÄ –¢–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ–º—Å—è –≤ –º–∏—Ä...")
        TeleportService:Teleport(TARGET_PLACE_ID, localPlayer)
        return true
    end
    return false
end

-- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
function main()
    print("üéØ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω! –ü–æ–∫—É–ø–∫–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã")
    
    if handlePlaceTeleportation() then
        return
    end

    local lastPlayerCheck = os.time()
    
    while true do
        local currentTime = os.time()
        
        -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–≥—Ä–æ–∫–æ–≤ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
        if currentTime - lastPlayerCheck >= CHECK_INTERVAL then
            if not checkPlayers() then
                wait(5)
                -- –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—é –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä
            end
            lastPlayerCheck = currentTime
        end
        
        -- –ü–û–ü–´–¢–ö–ê –ü–û–ö–£–ü–ö–ò –ö–ê–ñ–î–´–ï 2 –°–ï–ö–£–ù–î–´
        attemptStallPurchase()
        
        -- –ê–Ω—Ç–∏-–ê–§–ö
        antiAFK()
        
        wait(0.1) -- –ö–æ—Ä–æ—Ç–∫–∞—è –ø–∞—É–∑–∞ —á—Ç–æ–±—ã –Ω–µ –≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
    end
end

-- –ó–∞–ø—É—Å–∫
coroutine.wrap(function()
    pcall(main)
end)()
